# 第三天实践任务指南 - 开发环境搭建

## 任务1：使用Remix IDE创建第一个合约

### 1.1 访问Remix IDE
**步骤：**
1. 打开浏览器，访问 https://remix.ethereum.org/
2. 等待页面完全加载
3. 熟悉界面布局

### 1.2 创建新项目
**步骤：**
1. 在文件管理器中右键点击 `contracts` 文件夹
2. 选择 "New File"
3. 输入文件名：`HelloWorld.sol`
4. 按回车确认

### 1.3 编写Hello World合约
**代码：**
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract HelloWorld {
    string public message;
    address public owner;
    
    constructor() {
        message = "Hello, Web3 World!";
        owner = msg.sender;
    }
    
    function setMessage(string memory _message) public {
        require(msg.sender == owner, "Only owner can set message");
        message = _message;
    }
    
    function getMessage() public view returns (string memory) {
        return message;
    }
    
    function getOwner() public view returns (address) {
        return owner;
    }
}
```

### 1.4 编译合约
**步骤：**
1. 点击左侧的 "Solidity Compiler" 图标
2. 选择编译器版本：`0.8.19+commit.7dd6d404`
3. 点击 "Compile HelloWorld.sol" 按钮
4. 查看编译结果，确保没有错误

### 1.5 部署合约
**步骤：**
1. 点击左侧的 "Deploy & Run Transactions" 图标
2. 选择环境：`Remix VM (London)`
3. 选择合约：`HelloWorld`
4. 点击 "Deploy" 按钮
5. 等待部署完成

### 1.6 测试合约功能
**步骤：**
1. 在部署的合约下方找到合约实例
2. 点击 `getMessage` 按钮，查看返回值
3. 点击 `getOwner` 按钮，查看合约所有者
4. 在 `setMessage` 输入框中输入新消息
5. 点击 `setMessage` 按钮执行
6. 再次点击 `getMessage` 验证更新

---

## 任务2：搭建Hardhat开发环境

### 2.1 检查环境要求
**步骤：**
1. 打开终端/命令提示符
2. 检查Node.js版本：
   ```bash
   node --version
   ```
   （需要版本14或更高）
3. 检查npm版本：
   ```bash
   npm --version
   ```

### 2.2 创建项目目录
**步骤：**
```bash
# 创建项目目录
mkdir my-first-dapp
cd my-first-dapp

# 初始化npm项目
npm init -y
```

### 2.3 安装Hardhat
**步骤：**
```bash
# 安装Hardhat
npm install --save-dev hardhat

# 初始化Hardhat项目
npx hardhat init
```

**选择配置：**
- 选择 "Create a JavaScript project"
- 选择 "Yes" 安装依赖
- 选择 "Yes" 安装Git

### 2.4 项目结构说明
**生成的文件结构：**
```
my-first-dapp/
├── contracts/              # 智能合约目录
│   └── Lock.sol           # 示例合约
├── scripts/               # 部署脚本目录
│   └── deploy.js          # 部署脚本
├── test/                  # 测试文件目录
│   └── Lock.js            # 测试文件
├── hardhat.config.js      # Hardhat配置文件
└── package.json           # 项目配置文件
```

### 2.5 创建Hello World合约
**步骤：**
1. 删除 `contracts/Lock.sol`
2. 创建新文件 `contracts/HelloWorld.sol`
3. 复制以下代码：

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

contract HelloWorld {
    string public message;
    address public owner;
    uint256 public messageCount;
    
    event MessageUpdated(string newMessage, address updatedBy);
    
    constructor() {
        message = "Hello, Hardhat World!";
        owner = msg.sender;
        messageCount = 0;
    }
    
    function setMessage(string memory _message) public {
        require(msg.sender == owner, "Only owner can set message");
        message = _message;
        messageCount++;
        emit MessageUpdated(_message, msg.sender);
    }
    
    function getMessage() public view returns (string memory) {
        return message;
    }
    
    function getOwner() public view returns (address) {
        return owner;
    }
    
    function getMessageCount() public view returns (uint256) {
        return messageCount;
    }
}
```

### 2.6 编写部署脚本
**步骤：**
1. 编辑 `scripts/deploy.js`：

```javascript
const hre = require("hardhat");

async function main() {
  // 获取合约工厂
  const HelloWorld = await hre.ethers.getContractFactory("HelloWorld");
  
  // 部署合约
  const helloWorld = await HelloWorld.deploy();
  
  // 等待部署完成
  await helloWorld.deployed();
  
  console.log("HelloWorld deployed to:", helloWorld.address);
  console.log("Owner:", await helloWorld.getOwner());
  console.log("Initial message:", await helloWorld.getMessage());
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
```

### 2.7 测试部署
**步骤：**
```bash
# 启动本地Hardhat网络
npx hardhat node

# 在新终端中部署合约
npx hardhat run scripts/deploy.js --network localhost
```

---

## 任务3：部署合约到测试网

### 3.1 配置测试网
**步骤：**
1. 编辑 `hardhat.config.js`：

```javascript
require("@nomicfoundation/hardhat-toolbox");

module.exports = {
  solidity: "0.8.19",
  networks: {
    hardhat: {
      chainId: 1337
    },
    sepolia: {
      url: "https://sepolia.infura.io/v3/YOUR_PROJECT_ID",
      accounts: ["YOUR_PRIVATE_KEY"]
    }
  }
};
```

### 3.2 获取Infura项目ID
**步骤：**
1. 访问 https://infura.io/
2. 注册账户
3. 创建新项目
4. 选择 "Ethereum" 网络
5. 复制项目ID

### 3.3 获取私钥
**步骤：**
1. 打开MetaMask
2. 点击账户详情
3. 点击 "Export Private Key"
4. 输入密码
5. 复制私钥（注意安全）

### 3.4 创建环境变量文件
**步骤：**
1. 创建 `.env` 文件：
```
SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_PROJECT_ID
PRIVATE_KEY=YOUR_PRIVATE_KEY
```

2. 安装dotenv：
```bash
npm install dotenv
```

3. 更新 `hardhat.config.js`：
```javascript
require("@nomicfoundation/hardhat-toolbox");
require("dotenv").config();

module.exports = {
  solidity: "0.8.19",
  networks: {
    hardhat: {
      chainId: 1337
    },
    sepolia: {
      url: process.env.SEPOLIA_RPC_URL,
      accounts: [process.env.PRIVATE_KEY]
    }
  }
};
```

### 3.5 部署到测试网
**步骤：**
```bash
# 确保有足够的测试ETH
# 部署到Sepolia测试网
npx hardhat run scripts/deploy.js --network sepolia
```

### 3.6 验证合约
**步骤：**
1. 复制合约地址
2. 访问 https://sepolia.etherscan.io/
3. 搜索合约地址
4. 点击 "Contract" 标签
5. 点击 "Verify and Publish"
6. 填写验证信息

---

## 实践任务检查清单

### Remix IDE使用
- [ ] 成功访问Remix IDE
- [ ] 创建新项目文件
- [ ] 编写Hello World合约
- [ ] 成功编译合约
- [ ] 部署到Remix VM
- [ ] 测试合约功能

### Hardhat环境搭建
- [ ] 检查Node.js和npm版本
- [ ] 创建项目目录
- [ ] 安装Hardhat
- [ ] 初始化项目
- [ ] 创建Hello World合约
- [ ] 编写部署脚本
- [ ] 本地部署测试

### 测试网部署
- [ ] 配置测试网RPC
- [ ] 设置环境变量
- [ ] 获取测试ETH
- [ ] 部署到测试网
- [ ] 在Etherscan验证合约
- [ ] 测试合约功能

---

## 常见问题解答

### Q1: Remix IDE编译失败怎么办？
A: 检查Solidity版本是否匹配，确保语法正确，查看错误信息。

### Q2: Hardhat安装失败怎么办？
A: 确保Node.js版本正确，清除npm缓存，使用yarn替代npm。

### Q3: 部署到测试网失败怎么办？
A: 检查RPC URL是否正确，确保有足够的测试ETH，验证私钥格式。

### Q4: 合约验证失败怎么办？
A: 确保源代码与部署的合约完全一致，检查编译器版本。

### Q5: 如何获取更多测试ETH？
A: 使用多个水龙头，等待24小时后再次申请。

---

## 学习成果验证

完成今天的实践任务后，你应该能够：

1. **熟练使用Remix IDE**
   - 创建和编辑合约
   - 编译和部署合约
   - 与合约交互

2. **搭建Hardhat开发环境**
   - 安装和配置Hardhat
   - 创建项目结构
   - 编写部署脚本

3. **部署合约到测试网**
   - 配置网络参数
   - 管理环境变量
   - 验证合约代码

4. **理解开发流程**
   - 编写 → 编译 → 测试 → 部署
   - 本地开发 → 测试网部署
   - 合约验证和交互

---

## 安全提醒

### 开发环境安全
- **永远不要提交私钥到Git**
- **使用环境变量管理敏感信息**
- **定期更新依赖包**
- **验证下载的工具和库**

### 测试网安全
- **测试网是安全的实验环境**
- **测试ETH没有真实价值**
- **可以放心进行各种实验**
- **但也要养成良好的安全习惯**

---

## 下一步学习

### 明天学习内容
- Solidity语言基础
- 数据类型和变量
- 函数和修饰符
- 事件和错误处理

### 建议预习
- 了解Solidity基本语法
- 思考智能合约的安全性
- 准备编写更复杂的合约

---

**记住：开发环境是智能合约开发的基础，熟练掌握工具才能高效开发！多实践，多尝试，遇到问题及时查阅文档！** 🚀
